<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>Insert title here</title>

<link href="./css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
	<div class="panel panel-primary panel-lg">
	  
	    <div class="panel-heading" style="text-align:center;z-index:66;position:fixed;width:100%">
	        <h1 class="panel-title"><strong>爱培科管理制度</strong></h1>
	    </div>
	    <div style="z-index:66;position:fixed;width:100%;top:40px;">
	    	<form class="bs-example bs-example-form" >
	        <div class="input-group"> 
	       	 <div class="input-group-addon" style="cursor:pointer"><span class="glyphicon glyphicon-search"></span></div>
	            <input type="text" class="form-control" placeholder="搜索...." id="searchFileName">
	            <div class="input-group-addon" style="cursor:pointer" id="search">搜索</div>
	       </div>
		</form>
	 </div>
	    
	  <div style="height:65px;width:100%;">
	  </div>
	    <div class="panel-body" style="padding:0;  margin-top:5px;border:0px;">
			<ul class="list-group" >
			</ul>
   		 </div>  
	    </div>
	    <div class="panel-footer" style="position:fixed;bottom:0px;width:100%">
			<button class="btn btn-primary" id="top"> << </button>
			<!-- <button class="btn btn-primary"><span style="color:#fff" class="glyphicon glyphicon-chevron-right"></span></button> -->
		</div>
	</div>
</body>

<script type="text/javascript" src="./js/jquery.min.js"></script>
<script type="text/javascript" src="./js/bootstrap.min.js"></script>
<script type="text/javascript" src="./js/dingTalk.js"></script>
<script type="text/javascript" src="./js/utils.js"></script>
<script type="text/javascript" src="./js/ding.js"></script>
<script>

var file = '<span class="glyphicon glyphicon-file"></span>';
var catalog = '<span class="glyphicon glyphicon-folder-open"></span>';
var curentPath = "f://"
var height = document.body.scrollWidth - 200;
$(".panel-body").css("height",height);

console.log(height);
function listFile(Currentpath, flag) {
	$.ajax({
		url:"file/getFileList",
		type:"post",
		dataType:"json",
		data:{"path":Currentpath},
		success:function(data){
			$(".list-group-item").remove();
			
			if(flag == "notParent"){
			/* 	$("#viewerPlaceHolder").css("display","block"); */
				return;
			}else{
				/* $("#viewerPlaceHolder").css("display","none"); */
			}
			
			console.log(data);
			var child = data.data.fileChild;
			var paramList = [];
			for(var i in child) {
				var icon;
				var f;
				if(child[i].isParent) {
					icon = catalog;
					f = "isParent";
				} else {
					icon = file;
					f = "notParent";
				}
				paramList.push('<li class="list-group-item" style="cursor:pointer" data-file="'+f+'" data-path="'+child[i].filepath+'">'+icon+'&nbsp;&nbsp;'+child[i].filename+'</li>')
			}
			$(".list-group").append(paramList);
		}
	})
}

$(function(){
	//listFile(curentPath);
	$("body").on("click",".list-group-item",function(){
		var path = $(this).attr("data-path");
		var flag = $(this).attr("data-file")
		curentPath = path;
		
		//listFile(path,flag);
	})
	
	$("#top").click(function(){
		/* $("#viewerPlaceHolder").css("display","none"); */
		$.ajax({
			url:"file/topDirector",
			data:{"path":curentPath},
			dataType:"json",
			type:"post",
			success:function(data){
				$(".list-group-item").remove();
				var child = data.data.fileChild;
				var paramList = [];
				for(var i in child) {
					var icon;
					if(child[i].isParent) {
						icon = catalog;
					} else {
						icon = file;
					}
					paramList.push('<li class="list-group-item" style="cursor:pointer" data-path="'+child[i].filepath+'">'+icon+'&nbsp;&nbsp;'+child[i].filename+'</li>')
				}
				$(".list-group").append(paramList);
			}
		})
	})
	
	$("#search").click(function(){

		var fileName = $("#searchFileName").val();
		$.ajax({
			url:"file/searchFile",
			type:"post",
			dataType:'json',
			data:{"fileName":fileName},
			beforeSend: function(){
				$("#search").attr("disabled","disabled")
			 },
			success:function(data){
				$(".list-group-item").remove();
				var child = data.data;
				var paramList = [];
				console.log(data)
				for(var i in child) {
					var icon;
					if(child[i].isParent) {
						icon = catalog;
					} else {
						icon = file;
					}
					paramList.push('<li class="list-group-item" style="cursor:pointer" data-path="'+child[i].filepath+'">'+icon+'&nbsp;&nbsp;'+child[i].filename+'</li>');
				}
				$(".list-group").append(paramList);
			},
			complete: function(){
				$("#search").removeAttr("disabled")
			}
		})
		
	})
})	
var timestamp = Date.parse(new Date());	
var random = randomString(12)
DingTalkPC.config({
    agentId: '156271000', // 必填，微应用ID
    corpId: 'ding2cd2e57bc054942535c2f4657eb6378f',//必填，企业ID
    timeStamp: timestamp, // 必填，生成签名的时间戳
    nonceStr: "abcdefg", // 必填，生成签名的随机串
    signature: '9169f45eb6b294b85d63db5bf6dcff361828a78c', // 必填，签名
    jsApiList: ['device.notification.alert', 'device.notification.confirm'] // 必填，需要使用的jsapi列表
});
DingTalkPC.ready({
	logger.i('ready');
	DingTalkPC.device.notification.alert({
		message:"接口测试",
		title:"测试",
		button:"好的",
		onsuccess:function() {
			logger.i("hello");
		}
		onFail:function(err){
			logger.i(err)
		}
	})
})
DingTalkPC.error(function(error){
	console.log(error)
});

$(function(){
	/* $.ajax({
		url:"config/getConfig",
		type:"get",
		dataType:"json",
		success:function(data){
			console.log(data);
		}
	})	 */




})



 dd.config({
    agentId: '156271000', // 必填，微应用ID
    corpId: 'ding2cd2e57bc054942535c2f4657eb6378f',//必填，企业ID
    timeStamp: '1515223715' , // 必填，生成签名的时间戳
    nonceStr: 'abcdefg', // 必填，生成签名的随机串
    signature: '2a2a705aba9ffb82ec0dfb7f409c5bb7af5444b7', // 必填，签名
    type:0,   //选填。0表示微应用的jsapi,1表示服务窗的jsapi。不填默认为0。该参数从dingtalk.js的0.8.3版本开始支持
    jsApiList : [ 'runtime.info', 'biz.contact.choose',
        'device.notification.confirm', 'device.notification.alert',
        'device.notification.prompt', 'biz.ding.post',
        'biz.util.openLink','biz.cspace.preview','biz.cspace.chooseSpaceDir'] // 必填，需要使用的jsapi列表，注意：不要带dd。
}); 
dd.ready(function(){
	
	dd.biz.cspace.chooseSpaceDir({
        corpId:"ding2cd2e57bc054942535c2f4657eb6378f",
        onSuccess: function(data) {
        	console.log('----')
        	console.log(data);
         /* data结构
         {"data":
            [
            {
            "spaceId": "" //被选中的空间id
            "path": "", // 被选中的文件夹路径
            "dirId": "", //被选中的文件夹id
            }
            ]
         }
         */
        },
        onFail: function(err) {
            alert(JSON.stringify(err));
        }
});
});
dd.error(function(error){
    /**
     {
        message:"错误信息",//message信息会展示出钉钉服务端生成签名使用的参数，请和您生成签名的参数作对比，找出错误的参数
        errorCode:"错误码"
     }
    **/
    alert('dd error: ' + JSON.stringify(err));
});
</script>


</html>